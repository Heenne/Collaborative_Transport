<launch>
  <node respawn="true" pkg="joy" type="joy_node"  name="ps4_joy">
    <param name="dev" value="/dev/input/js0"/>
    <param name="deadzone" value="0.12"/>
    <param name="coalesce_interval" value="0.001"/>
  </node>

 <group ns="virtual_master">


  <include file="$(find mir_description)/launch/upload_mir_urdf.launch"/>
    <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher">
        <param name="tf_prefix" value="master"/>
    </node>

    

    <node name="state_machine_controller" pkg="transport_controller" type="ps4_statemachine_controller.py" output="screen">
            <remap from="joy" to="/joy" />
            <remap from="cmd_vel" to="master_velocity"/>
            <remap from="enable" to="/transport_state_machine/enable"/>
            <remap from="disable" to="/transport_state_machine/disable"/>
            <remap from="trigger" to="/transport_state_machine/trigger"/>
            <remap from="stop" to="/transport_state_machine/stop"/>
    </node>
    
    <node name="base_link_broadcaster" pkg="transport_launcher" type="base_broadcaster.py">
      <remap from="robot_pose" to="master_pose"/>
      <param name="tf_prefix" value="master"/>
    </node>

    <node name="cmd_vel_integrator" pkg="mir_helper" type="vel_integrator_node">
      <param name="topic_name" value="reset_pose"/>
      <param name="frame_id" value="/map"/>
      <remap from="cmd_vel" to="master_velocity"/>
      <remap from="cmd_vel_integrated" to="master_pose"/>
    </node>

    <node name="fake_mir_joint_publisher" pkg="mir_driver" type="fake_mir_joint_publisher.py" output="screen" />
    
  </group>
  
</launch>